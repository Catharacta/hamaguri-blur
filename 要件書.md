要件（サマリ）

ユーザーは複数のぼかしフィルターから選べる（ガウス、ボックス、型板ガラス風、ピクセルブラー等）。
アクティブウィンドウのみをくり抜いて周辺をぼかすモードと、画面全体をぼかすフルスクリーンモードの両方を持つ。
各フィルターはパラメータ調整可能（強度、半径、ブロックサイズ、ノイズ量など）かつリアルタイムプレビュー可能。
高速・低遅延でGPUシェーダを優先利用。GPU不可時は軽量なCPUフォールバックを用意。
マルチディスプレイ・DPI対応、除外アプリ・自動無効化ルール、ホットキー／マウスウィグルで起動。
A. 機能要件（詳細）

主要モード
アクティブウィンドウフォーカス（既存）
アクティブ（フォアグラウンド）ウィンドウを鮮明に、その他を選択したフィルターでぼかす／暗くする。
アクティブウィンドウの境界に沿った「くり抜き（ホール）」を正確に作成（矩形・丸角・余白オプション）。
全画面ブラー（追加）
画面全体を選択フィルターでぼかす（アプリやウィンドウの位置に関係なく画面全体が均一にぼやける）。
フルスクリーンアプリの上でも機能するモードと、キャプチャ制約で一部自動無効化するモードを用意（後述の実装制約参照）。
ぼかしフィルター（プリセット）
ガウスブラー（Gaussian Blur）
パラメータ：半径（ピクセル）、標準偏差（σ）、分離パス可（横・縦）。
特性：自然で滑らか、コストはやや高め（だが separable による最適化可）。
ボックスブラー（Box Blur / 平均化）
パラメータ：カーネルサイズ（幅）、反復回数（複数回で近似ガウス）。
特性：高速、ブロック状に見えやすいが反復で滑らかに。
型板ガラス風（Frosted / Frosted-glass）
説明：ぼかしに加え「微細ノイズ／ゆがみ（ノーマル風）」を入れてガラス越しの見え方を演出。
パラメータ：ぼかし強度、ノイズ量、ノイズスケール、屈折強度、彩度（オプション）。
実装：ぼかし＋ノイズマップ、サンプルオフセット（ノーマルマップ風）を組み合わせたシェーダで表現。
ピクセルブラー（Pixelation）
パラメータ：ブロックサイズ（例：4,8,16 px）、サンプリングモード（平均／中心値）。
特性：レトロなピクセル化、非常に低コスト（ダウンサンプリング→アップスケーリング）。
（拡張候補）モーションブラー、ガラススワール、Bokeh シミュレーション等
フィルター操作性
各フィルターは強度・半径などのスライダーで調整可能。
プリセット保存（ユーザー定義プリセット）／プリセット一覧（「弱め」「中」「強め」「集中」など）。
フィルターのブレンド：例えば「型板ガラス × ピクセル（少量）」のように複数を重ねる設定を将来追加可能。
プレビューと即時反映
設定画面にライブプレビュー（実環境のスクリーンショットを短時間キャプチャしてフィルター適用）を表示。
設定変更は即時反映（ただし高負荷を避けるためプレビュー時は低解像度キャプチャを使用可）。
ルール・例外
アプリ別除外（ホワイトリスト/ブラックリスト）：指定アプリではオーバーレイや全画面ブラーを無効化。
自動判定：フルスクリーンやゲームなど検出して自動的に無効化。
モニタ別設定：各ディスプレイごとに別々のフィルター／強度を設定可能。
トリガー
グローバルホットキー（カスタマイズ可）。
マウスウィグル（有効/無効化、感度設定）。
トレイメニュー、キーボードショートカット、タイマー（例：一定時間で消える）等。
B. 非機能要件（パフォーマンス・互換性）

レイテンシ目標
起動遅延：<100ms 目標（可能なら即時）。
フレーム反応：60fps 環境での描画遅延を最小化。プレビューは30fpsでも許容。
リソース
GPU アクセラレーションを基本（wgpu / Direct3D / DirectComposition など）。
常時監視時のCPU負荷は低く（例：<5% typical on modern CPU）、GPU負荷は可能なら <10%。
互換性
Windows 11（x64）標準サポート。ARM64 はオプション。
DPI、スケーリング、複合モニタ（異なる解像度/向き）対応。
プライバシー
すべてローカル処理。キャプチャ画像はローカルメモリ内でのみ処理し永続化しない（オプションでスクリーンショット保存は明示的に許可）。
フォールバック
GPU 利用不可時は簡易ボックスブラー／ピクセル化等の軽量CPUアルゴリズムにフォールバック。
C. 実装方針（技術的選択肢・トレードオフ）

ブラー描画アプローチ（選択肢）
A. オーバーレイ + 画面キャプチャ（Desktop Duplication API）
仕組み：DXGI Desktop Duplication でスクリーンをキャプチャ → GPUシェーダでぼかしてオーバーレイウィンドウに描画 → くり抜きでアクティブウィンドウは原画を表示する。
長所：元の表示を正確にぼかせる（ウィンドウ内容そのまま）。
短所：DRM/保護されたコンテンツ（動画 / ゲーム）でキャプチャ制限、キャプチャコスト、複数モニタでの実装複雑性。
B. オーバーレイ + 擬似ブラー（単純着色＋ノイズ／ピクセル化）
仕組み：元画面をキャプチャしないで、単純に暗転＋ノイズや半透明レイヤで“騙す”方法。
長所：軽量、全画面・ゲーム上でも動作しやすい。
短所：正確な“背景のぼかし”ではなく視覚的代替（ユーザーが違和感を覚える可能性）。
C. DWM / SetWindowCompositionAttribute（Windows のウィンドウコンポジション）
仕組み：Windows のウィンドウブラーAPIを利用して自分のウィンドウ背後をぼかす試み。
長所：ネイティブで高速な場合がある。
短所：他ウィンドウを直接ぼかす手段として制限が多く、望む動作が得られない可能性がある。
推奨：まず「A（キャプチャ＋GPUシェーダ）」でプロトタイプを作り、DRMや負荷問題が出た場合に「B（擬似ブラー）」で代替モードを用意する。Aは品質が高くユーザー満足度も高いが実装コストは高い。

シェーダ実装（GPU）
ガウス：完全分離（横→縦）の2パスシェーダで最適化。
ボックス：複数回の短いボックスパスで高速実装（integral image は大きいカーネルで有効）。
型板ガラス：ガウス or box の後にノイズ + オフセットマップ適用。ノイズはタイル／テクスチャベースで軽量に。
ピクセル化：レンダリング解像度を下げて nearest/linear の復元で実現（非常に軽量）。
グラフィックス API：wgpu（Rust クロスプラットフォーム）を検討。Windows 固有最適化として Direct3D11/12 を直接利用しても良い。
Tauri 構成（実装の分担）
フロントエンド：React/Vue/Svelte で設定UI／プレビュー。プリセット管理、トレイメニュー連携。
バックエンド（Rust）：Windows 固有処理（キャプチャ Desktop Duplication、ウィンドウ情報取得、グローバルフック、wgpu 初期化、レンダリングループ）を担当。Tauri コマンド or カスタムプラグイン経由でUIと連携。
既存 crates 候補：
windows = "windows-sys" / "windows"（WinAPI 呼び出し）
wgpu（GPU レンダリング・シェーダ）
dxgi / desktop-duplication ラッパー（存在する場合）
raw-window-handle/winit（ウィンドウハンドル管理）
serde（設定保存）
directories（ユーザ設定ディレクトリ）
tokio / crossbeam（レンダリングスレッド/コマンド連携）
D. UI / UX 要件

設定画面
フィルター選択ドロップダウン、各フィルターのパラメータスライダー、プリセット保存ボタン、プレビュー表示エリア。
プレビュー
低解像度でリアルタイムな“現在の画面”プレビューを表示。プレビュー更新頻度は設定で制御（例：低負荷モード）。
トレイアイコンメニュー
モード切替、直近プリセット、設定、終了。
初回オンボーディング
必要権限（フック/キャプチャ）のお知らせと手順、ショートカットの説明、推奨プリセットの提示。
アクセシビリティ
モーション低減オプション、テキストサイズ、色コントラスト。
E. 設定モデル（保存項目例）

global:
start_on_boot: bool
tray_icon: bool
triggers:
hotkey: string
mouse_wiggle_enabled: bool
wiggle_sensitivity: number
filters: array of { id, name, type, params:{...}, enabled }
mode_per_monitor: map monitor_id -> { mode: active-window | fullscreen, filter_id }
exceptions: { apps: [exeOrAppId], fullscreen_ignore: bool }
presets: map name -> filter_config
F. テスト項目

機能テスト
各フィルター（全強度レンジ）での見た目確認、プリセット保存/読み込み。
アクティブウィンドウくり抜きの正確さ（ウィンドウ移動/リサイズ時）。
全画面モードでの表示・消去（複数モニタ）。
例外アプリの自動無効化。
性能テスト
CPU/GPU 使用率、メモリ使用量、レイテンシ（トリガー→表示時間）。
低スペック環境（GPU が無い/古い）でのフォールバック動作。
互換性テスト
多種解像度・拡張DPI・HDR モニタ、ゲーム/フルスクリーンアプリでの挙動。
セキュリティ・権限テスト
セキュリティソフトや企業ポリシー下でのフックの問題。
G. リスクと緩和策

リスク：Desktop Duplication が DRM保護コンテンツや特定のGPUドライバでキャプチャできない
緩和：代替モード（擬似ブラー）を用意し、ユーザーに切り替えを案内。
リスク：高解像度/複数モニタでのパフォーマンス低下
緩和：解像度に応じたダウンサンプリング、動的に品質を下げる LOD、ユーザーに「低負荷モード」を提供。
リスク：グローバルフックがセキュリティソフトにブロックされる
緩和：ホットキーだけで代替、権限獲得手順ドキュメントの提供。
リスク：違和感ある型板ガラス表現
緩和：複数プリセットを用意しユーザーに選ばせる。
H. 優先度（フェーズ化）

フェーズ1（MVP、2〜6 週間）
アクティブウィンドウくり抜きオーバーレイ（擬似ブラーでも可）
フィルター：ピクセルブラー、ボックスブラー（軽量で実装が速い）
ホットキー、トレイ、設定の基本
設定保存／プリセット
フェーズ2（品質向上）
ガウスブラー（GPU separable 実装）
型板ガラス（基本ノイズ＋ぼかし）
マルチディスプレイ対応、マウスウィグル
ライブプレビュー
フェーズ3（拡張）
Desktop Duplication による高品質全画面/背景ブラー
フィルターブレンド、詳細パラメータ、ARM64 ビルド、インストーラ配布
自動品質調整、詳細なテストと最適化
I. 見積り（ラフ）

プロトタイプ（フェーズ1）: 週数 2–4 人週（1人での集中開発で約2–4 週間）
高品質実装（フェーズ1+2）: 6–12 人週（最適化、マルチモニタ、プレビュー含む）
Desktop Duplication + 品質最適化（フェーズ3）: 4–8 人週（環境対応、DRM対策含む） ※経験やチーム構成によって変動します。